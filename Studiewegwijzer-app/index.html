<!DOCTYPE html>
<html lang="nl" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudieWegwijzer</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        main {
            flex-grow: 1;
        }
        .view {
            display: none;
        }
        .view.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .chat-bubble-bot {
            background-color: #E0F2FE; /* light-blue-100 */
            align-self: flex-start;
        }
        .chat-bubble-user {
            background-color: #D1FAE5; /* light-green-100 */
            align-self: flex-end;
        }
        .chat-bubble {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 20px;
            margin-bottom: 8px;
            line-height: 1.4;
            word-wrap: break-word;
        }
        .typing-indicator {
            align-self: flex-start;
            display: flex;
            align-items: center;
            padding: 12px 16px;
        }
        .typing-indicator span {
            height: 8px;
            width: 8px;
            margin: 0 2px;
            background-color: #94A3B8; /* slate-400 */
            border-radius: 50%;
            display: inline-block;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <header class="bg-white shadow-sm sticky top-0 z-20">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" id="home-link" class="text-2xl font-black text-cyan-500">StudieWegwijzer</a>
            <button id="favorites-link" class="flex items-center space-x-2 text-slate-600 hover:text-cyan-500 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                </svg>
                <span class="font-bold hidden sm:inline">Mijn Favorieten</span>
            </button>
        </nav>
    </header>

    <main id="app-container" class="container mx-auto p-6">

        <!-- View 1: Homepage (Vakkenoverzicht) -->
        <section id="home-view" class="view active">
            <h2 class="text-3xl font-bold mb-2">Hoi! üëã Kies een vak om te beginnen</h2>
            <p class="text-slate-500 mb-8">Klik op een vak en ontdek de beste leerstrategie√´n.</p>
            <div id="vakken-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6">
                <!-- VakKaart componenten worden hier door JS ingevoegd -->
            </div>
        </section>

        <!-- View 2: Strategie√´n-pagina per Vak -->
        <section id="subject-view" class="view">
            <button class="back-button mb-6 inline-flex items-center text-cyan-600 font-bold hover:underline">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M11 17l-5-5m0 0l5-5m-5 5h12" />
                </svg>
                Terug naar alle vakken
            </button>
            <h2 id="subject-title" class="text-4xl font-black mb-8"></h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <h3 class="text-2xl font-bold mb-4">Algemene Strategie√´n</h3>
                    <div id="general-strategies-list" class="space-y-3"></div>
                </div>
                <div>
                    <h3 class="text-2xl font-bold mb-4">Specifiek voor dit Vak</h3>
                    <div id="specific-strategies-list" class="space-y-3"></div>
                </div>
            </div>
        </section>

        <!-- View 3: Detailpagina per Strategie -->
        <section id="strategy-view" class="view">
             <button class="back-button mb-6 inline-flex items-center text-cyan-600 font-bold hover:underline">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M11 17l-5-5m0 0l5-5m-5 5h12" />
                </svg>
                Terug naar strategie√´n
            </button>
            <div class="bg-white p-8 rounded-2xl shadow-lg">
                <div class="flex justify-between items-start">
                    <h2 id="strategy-title" class="text-4xl font-black mb-6 text-slate-800"></h2>
                    <button id="strategy-favorite-button" class="text-slate-300 hover:text-rose-500 transition-colors p-2 -mr-2 -mt-2">
                        <!-- Favoriet icoon wordt hier door JS ingevoegd -->
                    </button>
                </div>
                <div id="strategy-content" class="prose prose-lg max-w-none prose-h3:font-bold prose-h3:text-xl prose-h3:mb-2 prose-ul:list-disc prose-ul:pl-6 prose-li:mb-1 prose-strong:text-slate-700">
                    <!-- Inhoud wordt hier door JS ingevoegd -->
                </div>
            </div>
        </section>

        <!-- View 4: Mijn Favorieten -->
        <section id="favorites-view" class="view">
             <h2 class="text-3xl font-bold mb-8">Mijn Favoriete Strategie√´n ‚ù§Ô∏è</h2>
             <div id="favorites-list" class="space-y-4">
                <!-- Favorieten worden hier door JS ingevoegd -->
             </div>
        </section>
    </main>

    <footer class="py-8 mt-12 border-t border-slate-200">
        <div class="container mx-auto px-6 text-center">
            <img src="https://cdn.prod.website-files.com/651bf0dee4cd6972d132001b/651bf0dee4cd6972d13201f3_PCC-RGB-logo_Final.png" alt="PCC Logo" class="h-16 mx-auto">
            <p class="text-sm text-slate-500 mt-4">Gemaakt voor PCC Heiloo</p>
            <p class="text-xs text-slate-500 mt-1">Gemaakt door B. Vennik</p>
            <p class="text-xs text-slate-500 mt-1">Versie 12.7.25</p>
        </div>
    </footer>


    <!-- Chatbot Knop & Venster -->
    <div id="chatbot-container" class="fixed bottom-6 right-6 flex flex-col items-end z-30">
        <div id="chatbot-window" class="w-96 h-[32rem] bg-white rounded-2xl shadow-2xl mb-4 flex-col transition-all origin-bottom-right scale-0 hidden">
            <div class="p-4 bg-cyan-500 text-white rounded-t-2xl flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="text-3xl">ü¶â</div>
                    <div>
                        <h4 class="font-bold text-lg">Wijze Uil</h4>
                        <p class="text-sm opacity-80">Jouw hulp bij het leren</p>
                    </div>
                </div>
                <button id="chatbot-reset" title="Nieuw gesprek" class="p-2 rounded-full hover:bg-cyan-600 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h5M20 20v-5h-5M4 4l16 16" />
                    </svg>
                </button>
            </div>
            <div id="chat-messages" class="flex-1 p-4 overflow-y-auto flex flex-col">
                <!-- Chat messages will be dynamically inserted here -->
            </div>
            <div class="p-4 border-t border-slate-200 flex-shrink-0">
                <div id="chat-input-area" class="flex space-x-2">
                    <input type="text" id="chat-input" placeholder="Typ je antwoord..." class="flex-1 px-4 py-2 border border-slate-300 rounded-full focus:outline-none focus:ring-2 focus:ring-cyan-400">
                    <button id="chat-send" class="bg-cyan-500 text-white rounded-full p-3 hover:bg-cyan-600 transition-colors flex-shrink-0">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" /></svg>
                    </button>
                </div>
                 <input type="file" id="file-upload-input" class="hidden" accept=".txt">
            </div>
        </div>
        <button id="chatbot-toggle" class="bg-cyan-500 text-white w-16 h-16 rounded-full shadow-lg flex items-center justify-center text-4xl hover:bg-cyan-600 transition-transform hover:scale-110">ü¶â</button>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- DATA ---
    const appData = {
        subjects: [
            { id: 'nederlands', name: 'Nederlands', icon: 'üá≥üá±' },
            { id: 'engels', name: 'Engels', icon: 'üá¨üáß' },
            { id: 'frans', name: 'Frans', icon: 'üá´üá∑' },
            { id: 'duits', name: 'Duits', icon: 'üá©üá™' },
            { id: 'aardrijkskunde', name: 'Aardrijkskunde', icon: 'üåç' },
            { id: 'geschiedenis', name: 'Geschiedenis', icon: 'üìú' },
            { id: 'biologie', name: 'Biologie', icon: 'üß¨' },
            { id: 'wiskunde', name: 'Wiskunde', icon: 'üßÆ' },
            { id: 'nst', name: 'NST', icon: 'üß™' },
            { id: 'economie', name: 'Economie', icon: 'üìà' },
        ],
        strategies: [
            { id: 'pomodoro', type: 'general', title: 'Leren met de Pomodoro-techniek', content: '<h3>Wat is het?</h3><p class="mb-6">De Pomodoro-techniek helpt je geconcentreerd te werken in blokken van 25 minuten, met korte pauzes tussendoor. Dit verbetert je focus en voorkomt dat je moe wordt. Gebruik de timer hieronder om het zelf te proberen!</p><div class="mt-6 bg-slate-100 p-6 rounded-2xl text-center"><div id="pomodoro-timer" class="text-6xl font-black text-slate-800 tracking-tighter">25:00</div><p id="pomodoro-status" class="mt-2 font-bold text-cyan-600">Tijd om te leren!</p><div class="flex justify-center space-x-4 mt-6"><button id="pomodoro-start" class="px-6 py-2 bg-cyan-500 text-white font-bold rounded-full hover:bg-cyan-600 transition">Start</button><button id="pomodoro-pause" class="px-6 py-2 bg-amber-500 text-white font-bold rounded-full hover:bg-amber-600 transition">Pauze</button><button id="pomodoro-reset" class="px-6 py-2 bg-slate-500 text-white font-bold rounded-full hover:bg-slate-600 transition">Reset</button></div></div>' },
            { id: 'actief-herhalen', type: 'general', title: 'Actief herhalen: de sleutel tot onthouden', content: '<h3>Waarom alleen lezen niet werkt?</h3><p class="mb-4">Je hersenen hebben herhaling nodig. Maar niet zomaar herhalen! Actief herhalen betekent dat je je brein dwingt om de informatie op te halen. Dat is veel effectiever dan het alleen maar opnieuw lezen.</p><h3 class="mt-6">Hoe doe je dat?</h3><ul><li><strong>Maak toetsvragen:</strong> Schrijf op post-its vragen over de stof. Antwoord op de achterkant. Maak een stapel met goede en foute antwoorden en blijf de foute oefenen.</li><li><strong>Leg het uit aan een 6-jarige:</strong> Als je de stof in simpele taal kunt uitleggen (aan je broertje, zusje of zelfs een denkbeeldig persoon), dan weet je zeker dat je het snapt.</li><li><strong>Maak een oefentoets:</strong> Dit is de beste manier om te checken of je alles kent en kunt toepassen.</li></ul>' },
            { id: 'leerwerk-voorbereiden', type: 'general', title: 'Hoe bereid je je leerwerk voor?', content: '<h3 class="mt-6">Stap 1: Maak een complete lijst</h3><p>Schrijf alles op wat je moet leren voor een toets: welke hoofdstukken, paragrafen, aantekeningen, filmpjes, etc.</p><h3 class="mt-6">Stap 2: Bepaal wat belangrijk is</h3><p>Niet alles is even belangrijk. Vraag je docent wat de kern is, of kijk waar de meeste aantekeningen over gaan. Zet de belangrijkste onderdelen bovenaan je lijst.</p><h3 class="mt-6">Stap 3: Kleurcodeer wat je al kent</h3><ul><li><strong class="text-green-600">Groen:</strong> Dit ken/snap ik al goed.</li><li><strong class="text-orange-500">Oranje:</strong> Dit ken/snap ik redelijk.</li><li><strong class="text-red-600">Rood:</strong> Dit ken/snap ik nog niet goed.</li></ul><h3 class="mt-6">Stap 4: Bepaal de leervolgorde</h3><p>Begin altijd met de rode, belangrijke onderdelen. Werk daarna de rest van de lijst af. Zo besteed je de meeste tijd aan wat het moeilijkst is.</p>' },
            { id: 'dag-van-de-toets', type: 'general', title: 'Tips voor de dag van de toets', content: '<h3>Vooraf: Herhaal & Relax</h3><p>Kijk nog √©√©n keer kort je samenvatting door. Probeer daarna te ontspannen. Zenuwen helpen niet!</p><h3 class="mt-6">Tijdens de toets</h3><ul><li><strong>Lees de vraag 3x:</strong> 1. Scannend aan het begin. 2. Grondig bij het beantwoorden. 3. Controlerend aan het eind.</li><li><strong>Markeer sleutelwoorden:</strong> Omcirkel woorden als "leg uit", "noem drie redenen", zodat je geen delen van de vraag mist.</li><li><strong>Sla moeilijke vragen over:</strong> Kom je er niet uit? Zet een uitroepteken in de kantlijn en ga verder. Kom er later op terug.</li><li><strong>Herhaal de vraag in je antwoord:</strong> Vraag: "Waarom zijn bananen krom?" Antwoord: "Bananen zijn krom, omdat..." Dit helpt je een volledig antwoord te geven.</li></ul>' },
            { id: 'wiskunde-oefenen', type: 'wiskunde', title: 'Wiskunde is vooral: doen!', content: '<h3>Waarom oefenen zo belangrijk is?</h3><p class="mb-4">Bij wiskunde moet je brein nieuwe "paadjes" aanmaken. Dat gebeurt alleen door heel veel te oefenen. Denk niet te snel "ik kan het niet", maar "ik kan het NOG niet".</p><h3 class="mt-6">Hoe oefen je slim?</h3><ul><li><strong>Vraag je docent:</strong> Welke opgaven zijn het belangrijkst? Begin daarmee.</li><li><strong>Maak en kijk na:</strong> Maak een opgave ZONDER in je boek te kijken. Kijk hem daarna direct na.</li><li><strong>Vinkjes en kruisjes:</strong> Opgave goed? Zet een ‚úîÔ∏è. Fout of had je hulp nodig? Zet een ‚ùå.</li><li><strong>Herhaal de kruisjes:</strong> De opgaven met een kruisje maak je de volgende dag opnieuw, net zo lang tot je overal een vinkje hebt.</li><li><strong>Werk netjes:</strong> Werk stap voor stap en schrijf je berekeningen duidelijk op. Dit voorkomt slordigheidsfouten.</li></ul>' },
            { id: 'formuleblad-maken', type: 'wiskunde', title: 'Maak een formuleblad', content: '<h3>Waarom een formuleblad?</h3><p class="mb-4">Veel formules? Een formuleblad geeft overzicht en rust. Per hoofdstuk verzamel je alle formules op √©√©n plek.</p><h3 class="mt-6">Hoe maak je er een?</h3><ul><li><strong>Verzamel:</strong> Loop het hoofdstuk door en schrijf alle formules op.</li><li><strong>Orden:</strong> Koppel de formules aan onderwerpen. Bijvoorbeeld, alle formules over oppervlakte bij elkaar.</li><li><strong>Maak het netjes:</strong> Typ het blad uit of schrijf het heel duidelijk. Gebruik eventueel kleurtjes.</li></ul><p class="mt-4">Door het maken van het blad ben je al aan het leren!</p>' },
            { id: 'nst-oefenen', type: 'nst', title: 'NST is vooral: doen!', content: '<h3>Waarom oefenen zo belangrijk is?</h3><p class="mb-4">Bij exacte vakken zoals NST moet je brein nieuwe "paadjes" aanmaken. Dat gebeurt alleen door heel veel te oefenen. Denk niet te snel "ik kan het niet", maar "ik kan het NOG niet".</p><h3 class="mt-6">Hoe oefen je slim?</h3><ul><li><strong>Vraag je docent:</strong> Welke opgaven zijn het belangrijkst? Begin daarmee.</li><li><strong>Maak en kijk na:</strong> Maak een opgave ZONDER in je boek te kijken. Kijk hem daarna direct na.</li><li><strong>Vinkjes en kruisjes:</strong> Opgave goed? Zet een ‚úîÔ∏è. Fout of had je hulp nodig? Zet een ‚ùå.</li><li><strong>Herhaal de kruisjes:</strong> De opgaven met een kruisje maak je de volgende dag opnieuw, net zo lang tot je overal een vinkje hebt.</li><li><strong>Werk netjes:</strong> Werk stap voor stap en schrijf je berekeningen duidelijk op. Dit voorkomt slordigheidsfouten.</li></ul>' },
            { id: 'nst-formuleblad-maken', type: 'nst', title: 'Maak een formuleblad', content: '<h3>Waarom een formuleblad?</h3><p class="mb-4">Veel formules? Een formuleblad geeft overzicht en rust. Per hoofdstuk verzamel je alle formules op √©√©n plek.</p><h3 class="mt-6">Hoe maak je er een?</h3><ul><li><strong>Verzamel:</strong> Loop het hoofdstuk door en schrijf alle formules op.</li><li><strong>Orden:</strong> Koppel de formules aan onderwerpen. Bijvoorbeeld, alle formules over zwaartekracht bij elkaar.</li><li><strong>Maak het netjes:</strong> Typ het blad uit of schrijf het heel duidelijk. Gebruik eventueel kleurtjes.</li></ul><p class="mt-4">Door het maken van het blad ben je al aan het leren!</p>' },
            { id: 'vreemde-talen-leren', type: 'taal-algemeen', title: 'De 4 O\'s voor woordjes leren', content: '<h3>Wat moet je leren?</h3><p class="mb-4">Kijk goed wat er getoetst wordt. Alleen woordjes? Of ook grammatica en spelling? Zorg dat je alles oefent.</p><h3 class="mt-6">De 4 O\'s Methode</h3><p class="mb-4">Een handig stappenplan om woordjes te stampen:</p><ul><li><strong>Overkijken:</strong> Lees de woordenlijst rustig door om een eerste indruk te krijgen.</li><li><strong>Oplezen:</strong> Lees de woorden (Nederlands en de vreemde taal) hardop voor. Zo hoor je ook hoe het klinkt.</li><li><strong>Overschrijven:</strong> Schrijf de woordenlijsten over. Dit helpt enorm bij de spelling!</li><li><strong>Overhoren:</strong> Laat jezelf of iemand anders je overhoren. Gebruik online tools of flashcards.</li></ul>' },
            { id: 'talen-online-oefenen', type: 'taal-algemeen', title: 'Gebruik online tools en flashcards', content: '<h3>Waarom online oefenen?</h3><p class="mb-4">Websites en apps kunnen het leren van woordjes en grammatica veel leuker en effectiever maken. Ze overhoren je en helpen je focussen op wat je nog moeilijk vindt.</p><h3 class="mt-6">Handige tools</h3><ul><li><strong>WRTS & StudyGo:</strong> Perfect voor het overhoren van je eigen woordenlijsten.</li><li><strong>Quizlet:</strong> Maak digitale flashcards met woorden en begrippen. De \'leren\'-modus is super handig!</li><li><strong>Flashcards (op papier):</strong> Schrijf het woord op de ene kant en de vertaling op de andere. Maak een stapel \\\'goed\\\' en \\\'fout\\\' om slim te herhalen.</li></ul>' },
            { id: 'frans-uitlegfilmpjes', type: 'frans', title: 'Handige Uitlegfilmpjes', content: '<h3>Extra uitleg nodig?</h3><p>Soms is het fijn om de stof nog een keer door iemand anders uitgelegd te krijgen. Op YouTube staan super veel handige filmpjes!</p><h3 class="mt-6">Aanbevolen Kanalen</h3><ul><li>De Franse Juf</li><li>Patrick Schuitema</li></ul>' },
            { id: 'duits-uitlegfilmpjes', type: 'duits', title: 'Handige Uitlegfilmpjes', content: '<h3>Extra uitleg nodig?</h3><p>Soms is het fijn om de stof nog een keer door iemand anders uitgelegd te krijgen. Op YouTube staan super veel handige filmpjes!</p><h3 class="mt-6">Aanbevolen Kanalen</h3><ul><li>Mevrouw Duits</li><li>Martin Ringenaldus</li></ul>' },
            { id: 'engels-uitlegfilmpjes', type: 'engels', title: 'Handige Uitlegfilmpjes', content: '<h3>Extra uitleg nodig?</h3><p>Soms is het fijn om de stof nog een keer door iemand anders uitgelegd te krijgen. Op YouTube staan super veel handige filmpjes!</p><h3 class="mt-6">Aanbevolen Kanalen</h3><ul><li>EngelsAcademie</li></ul>' },
            { id: 'leesvaardigheid-nederlands', type: 'nederlands', title: 'Stappenplan voor een leestoets', content: '<h3>Hoe pak je een leestoets aan?</h3><ol class="mb-4"><li><strong>Scannend lezen:</strong> Bekijk eerst de titel, tussenkopjes en plaatjes. Waar gaat de tekst over?</li><li><strong>Grondig lezen:</strong> Lees nu de hele tekst goed door. Markeer kernwoorden en signaalwoorden.</li><li><strong>Vragen lezen:</strong> Lees de vraag heel precies. Wat wordt er gevraagd? Omcirkel belangrijke woorden in de vraag.</li><li><strong>Antwoord formuleren:</strong> Gebruik de woorden uit de tekst in je antwoord, tenzij er staat dat je eigen woorden moet gebruiken. Herhaal de vraag in je antwoord voor een volledige zin.</li></ol><h3 class="mt-6">Belangrijke termen</h3><ul><li><strong>Citeren:</strong> Letterlijk overnemen. Gebruik aanhalingstekens.</li><li><strong>Zinsdeel:</strong> Een deel van een zin, niet de hele zin.</li><li><strong>Eigen woorden:</strong> Niet citeren, maar de informatie zelf opschrijven.</li></ul>' },
            { id: 'geschiedenis-leren', type: 'geschiedenis', title: 'Leren voor Geschiedenis', content: '<h3>Begrijp het verhaal</h3><p class="mb-4">Geschiedenis is een verhaal. Probeer de grote lijn en de verbanden tussen gebeurtenissen te snappen. De leerdoelen aan het begin van een paragraaf helpen je hierbij.</p><h3 class="mt-6">Tips</h3><ul><li><strong>Leer de begrippen:</strong> De dikgedrukte woorden zijn de sleutel. Zorg dat je weet wat ze betekenen.</li><li><strong>Gebruik de samenvatting:</strong> Aan het eind van elke paragraaf staat een samenvatting. Dit is de kern van de stof!</li><li><strong>Maak een tijdlijn:</strong> Zet de belangrijkste gebeurtenissen en jaartallen op een rij. Dit geeft overzicht.</li></ul>' },
            { id: 'geschiedenis-uitlegfilmpjes', type: 'geschiedenis', title: 'Handige Uitlegfilmpjes', content: '<h3>Extra uitleg nodig?</h3><p>Soms is het fijn om de stof nog een keer door iemand anders uitgelegd te krijgen. Op YouTube staan super veel handige filmpjes!</p><h3 class="mt-6">Aanbevolen Kanalen</h3><ul><li>JORTgeschiedenis</li><li>Histoclips (via SchoolTV)</li></ul>' },
            { id: 'aardrijkskunde-leren', type: 'aardrijkskunde', title: 'Leren voor Aardrijkskunde', content: '<h3>Hoofdzaken en bijzaken</h3><p class="mb-4">Probeer de belangrijkste informatie (hoofdzaken) te onderscheiden van voorbeelden (bijzaken).</p><h3 class="mt-6">Tips</h3><ul><li><strong>Leer de begrippen:</strong> De blauwe of dikgedrukte woorden zijn het belangrijkst. Maak hier een lijst van.</li><li><strong>Begrijp kaarten en figuren:</strong> Zorg dat je de kaarten, grafieken en plaatjes in je boek snapt. Ze geven vaak de kern van de informatie weer.</li><li><strong>Beantwoord de leerdoelen:</strong> Maak van de leerdoelen aan het begin van de paragraaf vragen, en probeer die te beantwoorden.</li><li><strong>Maak een mindmap:</strong> Verbind de begrippen met elkaar in een mindmap om de verbanden te zien.</li></ul>' },
            { id: 'aardrijkskunde-uitlegfilmpjes', type: 'aardrijkskunde', title: 'Handige Uitlegfilmpjes', content: '<h3>Extra uitleg nodig?</h3><p>Soms is het fijn om de stof nog een keer door iemand anders uitgelegd te krijgen. Op YouTube staan super veel handige filmpjes!</p><h3 class="mt-6">Aanbevolen Kanalen</h3><ul><li>Aardrijkskunde kennisclips</li><li>Aardrijkskunde bijles</li></ul>' },
            { id: 'biologie-leren', type: 'biologie', title: 'Leren voor Biologie', content: '<h3>Relaties en processen</h3><p class="mb-4">Bij biologie gaat het om het begrijpen van processen en hoe dingen met elkaar te maken hebben.</p><h3 class="mt-6">Tips</h3><ul><li><strong>Leer de begrippen:</strong> De dikgedrukte woorden zijn de basis. Zorg dat je ze kunt uitleggen.</li><li><strong>Bestudeer de afbeeldingen:</strong> Plaatjes van cellen, organen of processen zijn superbelangrijk. Leer de namen van de onderdelen en hun functie.</li><li><strong>Maak een samenvatting:</strong> Schrijf per basisstof in je eigen woorden op wat het belangrijkste is.</li></ul>' },
            { id: 'biologie-uitlegfilmpjes', type: 'biologie', title: 'Handige Uitlegfilmpjes', content: '<h3>Extra uitleg nodig?</h3><p>Soms is het fijn om de stof nog een keer door iemand anders uitgelegd te krijgen. Op YouTube staan super veel handige filmpjes!</p><h3 class="mt-6">Aanbevolen Kanalen</h3><ul><li>Biologie met Joost</li><li>NGBiologie</li></ul>' },
            { id: 'economie-leren', type: 'economie', title: 'Leren voor Economie', content: '<h3>Rekenen en begrippen</h3><p class="mb-4">Economie is een combinatie van het begrijpen van begrippen en het kunnen toepassen van rekenformules.</p><h3 class="mt-6">Tips</h3><ul><li><strong>Leer de begrippen:</strong> De begrippen in de kantlijn zijn de basis. Zorg dat je ze kent.</li><li><strong>Oefen met rekenen:</strong> De formules moet je veel oefenen. Maak de rekenopgaven uit het boek meerdere keren.</li><li><strong>Maak de oefentoets:</strong> Aan het eind van elk hoofdstuk staat een oefentoets. Maak deze om te checken of je alles snapt.</li><li><strong>Bekijk de presentaties:</strong> Kijk de PowerPoints van je docent nog eens rustig door.</li></ul>' },
            { id: 'economie-uitlegfilmpjes', type: 'economie', title: 'Handige Uitlegfilmpjes', content: '<h3>Extra uitleg nodig?</h3><p>Soms is het fijn om de stof nog een keer door iemand anders uitgelegd te krijgen. Op YouTube staan super veel handige filmpjes!</p><h3 class="mt-6">Aanbevolen Kanalen</h3><ul><li>Economie met Jos</li><li>Economy Academy</li><li>Meester Patrick</li></ul>' },
             { id: 'nederlands-uitlegfilmpjes', type: 'nederlands', title: 'Handige Uitlegfilmpjes', content: '<h3>Extra uitleg nodig?</h3><p>Soms is het fijn om de stof nog een keer door iemand anders uitgelegd te krijgen. Op YouTube staan super veel handige filmpjes!</p><h3 class="mt-6">Aanbevolen Kanalen</h3><ul><li>Arnoud Kuijpers</li><li>Maarten de Krosse</li></ul>' },
             { id: 'wiskunde-uitlegfilmpjes', type: 'wiskunde', title: 'Handige Uitlegfilmpjes', content: '<h3>Extra uitleg nodig?</h3><p>Soms is het fijn om de stof nog een keer door iemand anders uitgelegd te krijgen. Op YouTube staan super veel handige filmpjes!</p><h3 class="mt-6">Aanbevolen Kanalen</h3><ul><li>Math with Menno</li><li>WiskundeAcademie</li></ul>' },
             { id: 'nst-uitlegfilmpjes', type: 'nst', title: 'Handige Uitlegfilmpjes', content: '<h3>Extra uitleg nodig?</h3><p>Soms is het fijn om de stof nog een keer door iemand anders uitgelegd te krijgen. Op YouTube staan super veel handige filmpjes!</p><h3 class="mt-6">Aanbevolen Kanalen</h3><ul><li>Meneer Wietsema Natuurkunde</li><li>Scheikundelessen</li></ul>' },
        ]
    };

    let state = { currentPage: 'home-view', currentSubject: null, currentStrategy: null, favorites: [] };
    
    const views = document.querySelectorAll('.view');
    const appContainer = document.getElementById('app-container');
    const homeLink = document.getElementById('home-link');
    const favoritesLink = document.getElementById('favorites-link');

    // --- POMODORO TIMER STATE ---
    let pomodoro = {
        interval: null,
        timeLeft: 25 * 60,
        isPaused: true,
        mode: 'work', // 'work', 'shortBreak', 'longBreak'
        sessions: 0,
    };

    const updateView = () => {
        views.forEach(view => view.classList.toggle('active', view.id === state.currentPage));
        window.scrollTo(0, 0);
    };

    const navigateTo = (page, subjectId = null, strategyId = null) => {
        if (state.currentStrategy === 'pomodoro' && strategyId !== 'pomodoro') {
            clearInterval(pomodoro.interval);
        }

        state.currentPage = page;
        if(subjectId) state.currentSubject = subjectId;
        if(strategyId) state.currentStrategy = strategyId;

        if (page === 'home-view') { state.currentSubject = null; state.currentStrategy = null; renderHome(); }
        if (page === 'subject-view') { state.currentStrategy = null; renderSubjectView(subjectId); }
        if (page === 'strategy-view') renderStrategyView(strategyId);
        if (page === 'favorites-view') renderFavoritesView();
        
        updateView();
    };

    const renderHome = () => {
        const grid = document.getElementById('vakken-grid');
        grid.innerHTML = appData.subjects.map(subject => `
            <a href="#" data-subject-id="${subject.id}" class="subject-link bg-white p-6 rounded-2xl shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all flex flex-col items-center justify-center text-center aspect-square">
                <div class="text-5xl mb-3">${subject.icon}</div>
                <h3 class="font-bold text-lg">${subject.name}</h3>
            </a>
        `).join('');
    };
    
    const renderStrategyListItem = (strategy) => {
        const isFav = state.favorites.includes(strategy.id);
        return `
            <div class="bg-white p-4 rounded-xl shadow-sm flex justify-between items-center">
                <a href="#" data-strategy-id="${strategy.id}" class="strategy-link font-bold text-slate-700 hover:text-cyan-600 flex-1">${strategy.title}</a>
                <button data-favorite-id="${strategy.id}" class="favorite-button p-2 text-2xl transition-transform hover:scale-125 ${isFav ? 'text-rose-500' : 'text-slate-300'}">‚ô•</button>
            </div>`;
    };

    const renderSubjectView = (subjectId) => {
        const subject = appData.subjects.find(s => s.id === subjectId);
        document.getElementById('subject-title').textContent = subject.name;
        
        const generalList = document.getElementById('general-strategies-list');
        const specificList = document.getElementById('specific-strategies-list');
        
        generalList.innerHTML = appData.strategies.filter(s => s.type === 'general').map(renderStrategyListItem).join('');
        
        let subjectStrategies = appData.strategies.filter(s => s.type === subject.id);
        if (['frans', 'engels', 'duits'].includes(subject.id)) {
            subjectStrategies = subjectStrategies.concat(appData.strategies.filter(s => s.type === 'taal-algemeen'));
        }

        specificList.innerHTML = subjectStrategies.map(renderStrategyListItem).join('');
            
        if (specificList.innerHTML === '') specificList.innerHTML = '<p class="text-slate-500">Er zijn nog geen specifieke strategie√´n voor dit vak.</p>';
    };
    
    const renderStrategyView = (strategyId) => {
        const strategy = appData.strategies.find(s => s.id === strategyId);
        document.getElementById('strategy-title').textContent = strategy.title;
        document.getElementById('strategy-content').innerHTML = strategy.content;
        
        const favButton = document.getElementById('strategy-favorite-button');
        favButton.dataset.favoriteId = strategy.id;
        
        const isFav = state.favorites.includes(strategy.id);
        favButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" viewBox="0 0 20 20" fill="${isFav ? 'currentColor' : 'none'}" stroke="currentColor" stroke-width="1"><path d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" /></svg>`;
        favButton.classList.toggle('text-rose-500', isFav);

        if (strategyId === 'pomodoro') {
            setupPomodoroListeners();
        }
    };
    
    const renderFavoritesView = () => {
        const favList = document.getElementById('favorites-list');
        const favoriteStrategies = appData.strategies.filter(s => state.favorites.includes(s.id));
        
        if (favoriteStrategies.length === 0) {
            favList.innerHTML = '<div class="bg-white p-8 rounded-2xl text-center shadow-sm"><p class="text-slate-500">Je hebt nog geen favorieten opgeslagen!</p><p class="mt-2">Klik op het hartje (‚ô•) bij een strategie om hem hier op te slaan.</p></div>';
            return;
        }
        favList.innerHTML = favoriteStrategies.map(renderStrategyListItem).join('');
    };
    
    const loadFavorites = () => {
        const favs = localStorage.getItem('studiewegwijzer_favorites');
        state.favorites = favs ? JSON.parse(favs) : [];
    };

    const saveFavorites = () => {
        localStorage.setItem('studiewegwijzer_favorites', JSON.stringify(state.favorites));
    };

    const toggleFavorite = (strategyId) => {
        const index = state.favorites.indexOf(strategyId);
        if (index > -1) state.favorites.splice(index, 1);
        else state.favorites.push(strategyId);
        saveFavorites();
        
        if(state.currentPage === 'subject-view') renderSubjectView(state.currentSubject);
        if(state.currentPage === 'strategy-view') renderStrategyView(state.currentStrategy);
        if(state.currentPage === 'favorites-view') renderFavoritesView();
    };

    const updatePomodoroDisplay = () => {
        const timerDisplay = document.getElementById('pomodoro-timer');
        if (!timerDisplay) return;
        const minutes = Math.floor(pomodoro.timeLeft / 60);
        const seconds = pomodoro.timeLeft % 60;
        timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    };

    const startPomodoro = () => {
        if (pomodoro.isPaused) {
            pomodoro.isPaused = false;
            pomodoro.interval = setInterval(() => {
                pomodoro.timeLeft--;
                updatePomodoroDisplay();
                if (pomodoro.timeLeft <= 0) {
                    clearInterval(pomodoro.interval);
                    switch (pomodoro.mode) {
                        case 'work':
                            pomodoro.sessions++;
                            pomodoro.mode = (pomodoro.sessions % 4 === 0) ? 'longBreak' : 'shortBreak';
                            pomodoro.timeLeft = (pomodoro.mode === 'longBreak') ? 15 * 60 : 5 * 60;
                            document.getElementById('pomodoro-status').textContent = (pomodoro.mode === 'longBreak') ? "Tijd voor een lange pauze!" : "Tijd voor een korte pauze!";
                            break;
                        case 'shortBreak':
                        case 'longBreak':
                            pomodoro.mode = 'work';
                            pomodoro.timeLeft = 25 * 60;
                            document.getElementById('pomodoro-status').textContent = "Tijd om weer te leren!";
                            break;
                    }
                    pomodoro.isPaused = true;
                    updatePomodoroDisplay();
                }
            }, 1000);
        }
    };

    const pausePomodoro = () => {
        pomodoro.isPaused = true;
        clearInterval(pomodoro.interval);
    };

    const resetPomodoro = () => {
        pausePomodoro();
        pomodoro.mode = 'work';
        pomodoro.timeLeft = 25 * 60;
        pomodoro.sessions = 0;
        document.getElementById('pomodoro-status').textContent = "Tijd om te leren!";
        updatePomodoroDisplay();
    };

    const setupPomodoroListeners = () => {
        document.getElementById('pomodoro-start').addEventListener('click', startPomodoro);
        document.getElementById('pomodoro-pause').addEventListener('click', pausePomodoro);
        document.getElementById('pomodoro-reset').addEventListener('click', resetPomodoro);
        updatePomodoroDisplay();
    };

    homeLink.addEventListener('click', (e) => { e.preventDefault(); navigateTo('home-view'); });
    favoritesLink.addEventListener('click', (e) => { e.preventDefault(); navigateTo('favorites-view'); });

    appContainer.addEventListener('click', (e) => {
        const subjectLink = e.target.closest('.subject-link');
        if (subjectLink) { e.preventDefault(); navigateTo('subject-view', subjectLink.dataset.subjectId); }
        
        const strategyLink = e.target.closest('.strategy-link');
        if (strategyLink) { e.preventDefault(); navigateTo('strategy-view', state.currentSubject, strategyLink.dataset.strategyId); }

        const backButton = e.target.closest('.back-button');
        if (backButton) {
            e.preventDefault();
            if (state.currentPage === 'strategy-view') navigateTo('subject-view', state.currentSubject);
            else if (state.currentPage === 'subject-view') navigateTo('home-view');
        }
        
        const favoriteButton = e.target.closest('.favorite-button, #strategy-favorite-button');
        if (favoriteButton) { e.preventDefault(); toggleFavorite(favoriteButton.dataset.favoriteId); }
    });
    
    // --- GEMINI CHATBOT ---
    const chatbot = {
        elements: {
            toggle: document.getElementById('chatbot-toggle'),
            window: document.getElementById('chatbot-window'),
            messages: document.getElementById('chat-messages'),
            input: document.getElementById('chat-input'),
            send: document.getElementById('chat-send'),
            resetBtn: document.getElementById('chatbot-reset'),
            fileUpload: document.getElementById('file-upload-input'),
            inputArea: document.getElementById('chat-input-area'),
        },
        chatHistory: [],

        init() {
            this.elements.toggle.addEventListener('click', () => this.toggleWindow());
            this.elements.send.addEventListener('click', () => this.handleUserInput());
            this.elements.input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') this.handleUserInput();
            });
            this.elements.fileUpload.addEventListener('change', (e) => this.handleFileUpload(e));
            this.elements.resetBtn.addEventListener('click', () => this.reset());
            this.reset();
        },

        toggleWindow() {
            this.elements.window.classList.toggle('hidden');
            this.elements.window.classList.toggle('flex');
            this.elements.window.classList.toggle('scale-0');
            this.elements.window.classList.toggle('scale-100');
            if (!this.elements.window.classList.contains('scale-0')) {
                this.elements.input.focus();
            }
        },
        
        addMessage(content, sender, isHTML = false) {
            const bubble = document.createElement('div');
            if (isHTML) {
                bubble.innerHTML = content;
            } else {
                bubble.className = `chat-bubble chat-bubble-${sender}`;
                bubble.textContent = content;
            }
            this.elements.messages.appendChild(bubble);
            this.scrollToBottom();
        },

        addTypingIndicator() {
            const indicator = document.createElement('div');
            indicator.className = 'typing-indicator';
            indicator.id = 'typing-indicator';
            indicator.innerHTML = '<span></span><span></span><span></span>';
            this.elements.messages.appendChild(indicator);
            this.scrollToBottom();
        },

        removeTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) indicator.remove();
        },

        scrollToBottom() {
            this.elements.messages.scrollTop = this.elements.messages.scrollHeight;
        },

        handleUserInput() {
            const userInput = this.elements.input.value.trim();
            if (userInput === '') return;
            this.addMessage(userInput, 'user');
            this.elements.input.value = '';
            this.getGeminiResponse(userInput);
        },
        
        handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (file.type !== 'text/plain') {
                this.addMessage("Sorry, ik kan alleen .txt-bestanden lezen. Kopieer de tekst uit je Word- of PDF-bestand en plak het in een nieuw .txt-bestand.", 'bot');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                const fileContent = e.target.result;
                this.addMessage(`Bestand "${file.name}" is ge√ºpload.`, 'user');
                this.getGeminiResponse(`Ik heb mijn leerdoelen ge√ºpload. De inhoud is: "${fileContent}". Maak alsjeblieft een planning.`);
            };
            reader.readAsText(file);
        },
        
        async getGeminiResponse(prompt) {
            this.addTypingIndicator();
            this.elements.input.disabled = true;

            // This now calls the secure Netlify function
            const apiUrl = '/.netlify/functions/ask-wise-owl';
            
            this.chatHistory.push({ role: "user", parts: [{ text: prompt }] });
            
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ chatHistory: this.chatHistory })
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.statusText}`);
                }

                const result = await response.json();
                
                let botResponse = "Sorry, ik kon geen antwoord bedenken. Probeer het anders te vragen.";
                if (result.candidates && result.candidates[0]?.content?.parts[0]?.text) {
                    botResponse = result.candidates[0].content.parts[0].text;
                }
                
                this.chatHistory.push({ role: "model", parts: [{ text: botResponse }] });
                
                const formattedResponse = botResponse.replace(/(Dag|Checkvragen Dag) \d+:/g, (match) => `<strong>${match}</strong>`).split('\n').join('<br>');
                this.addMessage(`<div class="chat-bubble chat-bubble-bot">${formattedResponse}</div>`, 'bot', true);

                if (botResponse.toLowerCase().includes("document met de leerdoelen")) {
                    const uploadButton = document.createElement('button');
                    uploadButton.textContent = 'Kies .txt bestand';
                    uploadButton.className = 'bg-amber-500 text-white font-bold py-2 px-4 rounded-lg my-2 mx-auto block';
                    uploadButton.onclick = () => this.elements.fileUpload.click();
                    this.elements.messages.appendChild(uploadButton);
                    this.scrollToBottom();
                }

            } catch (error) {
                console.error("API call failed:", error);
                this.addMessage("Oeps, er ging iets mis met de verbinding. Probeer het later opnieuw.", 'bot');
            } finally {
                this.removeTypingIndicator();
                this.elements.input.disabled = false;
                this.elements.input.focus();
            }
        },
        
        reset() {
            this.elements.messages.innerHTML = '';
            this.addMessage("Hoi! Ik ben de Wijze Uil ü¶â. Ik kan je helpen met een planning, of je kunt me vragen stellen over leren. Waar kan ik je mee helpen?", 'bot');
            this.chatHistory = [{
                role: "user",
                parts: [{ text: "Je bent de Wijze Uil, een vrolijke en behulpzame chatbot voor de webapp StudieWegwijzer. Je doel is om brugklassers (12-13 jaar) te helpen met leren. Je bent op de hoogte van alle leerstrategie√´n in de app, inclusief de YouTube-links. De strategie√´n zijn: " + JSON.stringify(appData.strategies) + ". Je kunt planningen maken en vragen beantwoorden. Als je een planning maakt, vraag dan eerst naar het vak, dan of ze leerdoelen hebben (als tekst of bestand), en dan het aantal dagen. Als je de leerdoelen hebt, vraag dan na het geven van de planning of je ook checkvragen moet maken. Houd je taalgebruik eenvoudig, positief en aanmoedigend." }]
            }, {
                role: "model",
                parts: [{ text: "Hoi! Ik ben de Wijze Uil ü¶â. Waar kan ik je vandaag mee helpen?" }]
            }];
        }
    };
    
    // --- INITIALIZATION ---
    loadFavorites();
    renderHome();
    chatbot.init();

});
</script>

</body>
</html>

